{"Name":"Sanitize Model Reponse","Description":"","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\nimport google.auth.transport.requests\nfrom google.oauth2 import service_account\nimport json\nimport requests\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n\n    sa_json = siemplify.extract_configuration_param('Integration',\"Service Account JSON\")\n    sa_json = json.loads(sa_json)\n    template_id = siemplify.extract_configuration_param('Integration',\"Template ID\")\n    region = siemplify.extract_configuration_param('Integration',\"Region\")\n    model_response = siemplify.extract_action_param(\"Model response\", print_value=True)\n\n    credentials = service_account.Credentials.from_service_account_info(\n        sa_json, scopes=[\"https://www.googleapis.com/auth/cloud-platform\"]\n    )\n    request = google.auth.transport.requests.Request()\n    credentials.refresh(request)\n    hd = {\n        \"Authorization\": \"Bearer \" + credentials.token,\n        \"Content-Type\": \"application/json\"\n    }\n    body = { \n            \"model_response_data\" : { \n                \"text\": model_response\n            } \n        }\n    URL = f\"https://modelarmor.{region}.rep.googleapis.com/v1/projects/gen-ai-apps/locations/us-east4/templates/{template_id}:sanitizeModelResponse\"\n    req = requests.post(URL, headers=hd, json=body)\n    siemplify.LOGGER.info(req.text)\n\n    status = EXECUTION_STATE_COMPLETED\n    output_message = \"Succesfully executed.\"\n    siemplify.result.add_result_json(req.json())\n    result_value = None\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Unofficial GCP Model Armor","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":true}],"Creator":"036fe879-4c16-461e-b6d9-b1c552806fa0","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":9.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"Hello world!","Description":"Response from the LLM to be sanitized.","Name":"Model response","Value":"Hello world!","Type":0,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}